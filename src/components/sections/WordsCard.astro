---
import Card from "../Card.astro";

const { words = [] } = Astro.props;
const safeWords = Array.isArray(words) ? words : [];
---

<Card>
  <div class="flex h-full flex-col justify-between gap-3">
    <div class="flex items-start justify-between gap-3">
      <blockquote
        class="mt-6 flex-1 border-l-2 pl-6 italic"
        data-quote
      >
        “{safeWords[0] ?? ""}”
      </blockquote>

      <div class="mt-6 flex shrink-0 items-center gap-1">
        <button
          type="button"
          data-prev
          aria-label="Frase anterior"
          class="rounded-md p-2 text-neutral-300 hover:bg-neutral-800 hover:text-neutral-50 focus:outline-none focus:ring-2 focus:ring-neutral-500 disabled:opacity-40"
        >
          <!-- Flecha izquierda -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>

        <button
          type="button"
          data-next
          aria-label="Frase siguiente"
          class="rounded-md p-2 text-neutral-300 hover:bg-neutral-800 hover:text-neutral-50 focus:outline-none focus:ring-2 focus:ring-neutral-500 disabled:opacity-40"
        >
          <!-- Flecha derecha -->
          <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 6l6 6-6 6" />
          </svg>
        </button>
      </div>
    </div>

    <p class="pl-6 text-xs text-neutral-400" data-meta></p>
  </div>

  <script define:vars={{ safeWords }}>
    const words = safeWords;

    const root = document.currentScript?.parentElement;
    const quoteEl = root?.querySelector("[data-quote]");
    const metaEl  = root?.querySelector("[data-meta]");
    const prevBtn = root?.querySelector("[data-prev]");
    const nextBtn = root?.querySelector("[data-next]");

    if (!quoteEl || !Array.isArray(words) || words.length === 0) return;

    let index = Number(localStorage.getItem("quoteIndex") ?? 0);
    if (!Number.isFinite(index) || index < 0 || index >= words.length) index = 0;

    const render = () => {
      quoteEl.textContent = `“${words[index]}”`;
      if (metaEl) metaEl.textContent = `${index + 1} / ${words.length}`;
      localStorage.setItem("quoteIndex", String(index));

      const disabled = words.length <= 1;
      if (prevBtn) prevBtn.disabled = disabled;
      if (nextBtn) nextBtn.disabled = disabled;
    };

    prevBtn?.addEventListener("click", () => {
      index = (index - 1 + words.length) % words.length;
      render();
    });

    nextBtn?.addEventListener("click", () => {
      index = (index + 1) % words.length;
      render();
    });

    render();
  </script>
</Card>
